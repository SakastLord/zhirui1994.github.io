---
title: '如何实现一个简单的事件模型？'
layout: post
comment: true
category: interview
tags: javascript
---
* content 
{:toc}

# 原理

事件模型，就是实现事件的绑定监听。实质上就是，23种设计模式中的观察者模式（又叫发布者-订阅者模式），是最常用的设计模式之一。我们常接触的js的dom事件就是观察者模式的实现。

# 实现

```javascript
var Events = function() {
    var listen, log, obj, one, remove, trigger, __this;
    obj = {};
    __this = this;
    
    listen = function( key, eventfn ) {
        var stack, _ref;
        stack = ( _ref = obj[key] ) != null ? _ref : obj[ key ] = [];
        return stack.push( eventfn );
 
    };
    
    one = function( key, eventfn ) {
        remove( key );
        return listen( key, eventfn ); 
    };
 
    remove = function( key ) {
        var _ref;
        return ( _ref = obj[key] ) != null ? _ref.length = 0 : void 0;
 
    };
 
    trigger = function() {
        var fn, stack, _i, _len, _ref, key;
        key = Array.prototype.shift.call( arguments ); 
        stack = ( _ref = obj[ key ] ) != null ? _ref : obj[ key ] = [];
        
        for ( _i = 0, _len = stack.length; _i < _len; _i++ ) {
            fn = stack[ _i ];
            if ( fn.apply( __this,  arguments ) === false) {
            return false;
        }
    }  
 
    return {
       listen: listen,
       one: one,
       remove: remove,
       trigger: trigger
       }
}
 ```
