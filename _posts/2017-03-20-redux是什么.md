---
title: redux是什么?
tags: react redux
category: react
layout: post
---
# flux
flux本身并不是库也不是框架,而是一种应用的框架思想.它的特点是,单项数据流,状态可预测.

# redux
redux参考了flux,可以说是flux的一种实现.对flux的冗余部分做了简化,同时将Elm语言的函数式编程思想融合其中.

# redux的三原则
1. 单一数据流
2. 状态是只读的
3. 状态修改均由纯函数完成

# redux核心API
- createStore(reducers,[initialState]) : 最核心的API,其创建的store本身又包含以下4个方法
    - getState() : 获取store中当前的状态
    - dispatch(action) : 分发一个action,并返回这个action,这是唯一能改变store中数据的方式.
    - subscribe(listener) : 注册一个监听者,他在store发生变化时被调用.
    - replaceReducer(nextReducer) : 更新当前store里的reducer,一般只会在开发模式中调用该方法.

replaceReducer()和subscribe()方法一般在和某系统做桥接的时候用.

# 与react绑定
由react-redux库提供

- <Provider store={store}> </Provider> : 整个redux应用的顶层组件
- connect(props)(Component) : 它是一个高价函数,可以让react应用中的任意组件获取到store中的数据.

# 理解redux中middleware的机制

redux提供了applyMiddleware方法来加载middleware,该方法的源码如下:

```javascript
import compose from './compose'

export default function applyMiddleware(...middleware) {
    return (next) => (reducer, initialState);
    let store = next(reducer, initialState);
    let dispatch = store.dispatch;
    let chain = [];
    
    var middlewareAPI = {
    getState: store.getState,
    dspatch: (action) => dispatch(action)
    };
    
    chain = middleware.map(middleware => middleware(middlewareAPI);
    dispatch = compose(...chain)(store.dispatch);
    
    return {
        ...store,
        dispatch
        };
    }
}
```

logger middleware的实现
```javascript
export default store => next => action => {
    console.log('dispatch:', action);
    next(action);
    console.log('finish:', action):
}


















